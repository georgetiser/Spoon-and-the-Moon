-- Coded and developed by George Tiser.-- Modifies/uses book materials and code originally produced by Kwik for Adobe Photoshop - Developed by Kwiksher. Copyright (C) 2012 kwiksher.com. All Rights Reserved. Exported on Wed Jun 12 2013 14:36:36 GMT-0400.-- Uses Director class, by Ricardo Rauber/Jonathan Beebe -- Exported on Wed Jun 12 2013 14:36:36 GMT-0400-- uses gTween class, by Josh Tynjala (modified by Kwiksher) ---- v.2015 formatted, coded and developed by George Tiser_G.kwk_readMe = 0 _G.kwk_firstPage = 112_G.kwk_currentPage = 112_G.kwk_menuPage = 113_G.kwk_lastPage = 211_G.kwk_creditsPage = 211_G.kwk_firstPageOfChapter = {112, 112, 112, 112, 112, 112, 112,	114, 127, 144, 158, 174, 191, 198, 208, 211}local environment = system.getInfo( "environment" )if environment == "simulator" then	statusreport = require("gt_debug")	_G.kwk_ShowDebugOutput = 1	print(environment)else	_G.kwk_ShowDebugOutput = nil -- use nil to turn off, or 1 to activate (print statements)	statusreport = require("gt_nodebug")end_G.kwk_DebugBuildVersion = "15-08-13/EE"-- Set directories where to find files.imageDir = "images/" audioDir = "audio/" videoDir = "" -- cannot be usedspriteDir = "" -- doesn't get used-- Set defaults.defaultTransparentImage = imageDir .. "transparentbutton.png"defaultNavigation = {	defaultBackButton = {		category = "navigation button",		id = "NavigationButtonBack",		imageFile = imageDir .. "kwkBback.png",		alpha = 1,		width = 111,		height = 88,		x = 290,		y = 975,		transitionEffect = "moveFromLeft",		touchSound = "click.mp3",	},	defaultForwardButton = {		category = "navigation button",		id = "NavigationButtonForward",		imageFile = imageDir .. "kwkBforward.png",		alpha = 1,		width = 111,		height = 88,		x = 475,		y = 975,		transitionEffect = "moveFromRight",		touchSound = "click.mp3",	},	defaultMenuButton = {		category = "navigation button",		id = "NavigationButtonMenu",		imageFile = imageDir .. "kwkBindex.png",		alpha = 1,		width = 66,		height = 69,		x = 383,		y = 969,		transitionEffect = "overFromTop",		imageFile = imageDir .. "kwkBindex.png",		touchSound = audioDir .. "indexflip.mp3",	},	defaultPageCornerButton = {		category = "navigation button",		id = "NavigationButtonCorner",		imageFile = imageDir .. "PageCornerGrey.png",		alpha = 1,		width = 72,		height = 80,		x = 732,		y = 984,		transitionEffect = "fade",		touchSound = "click.mp3",	},	defaultPageNumberText = {		category = "text",		alpha = 1, -- doesn't get used		width = 72,		height = 80,		x1d = 744,		x2d = 737,		x3d = 730,		x = 752,		xOffset = 8,		y = 995,		fontname = "Arbutus Slab",		fontsize = 20,		id = "NavigationPageNumber",	},	navigationScheme = "Standard",}-- Lists lua files containing definitions we need.director = require("director") --Gesture = require("dmc_gesture") --MultiTouch = require("dmc_multitouch") --system.activate("multitouch") json = require("json") ui = require("ui")uii = require("uii")navigation = require("gt_navigation")soundeffects = require("gt_sound")local gtween = require("gtween") if _G.kwk_ShowDebugOutput then	local chaps	chaps = "Chapters set"	print("");print("");print("");print("");print("");print("")	print("Global page data initialized.");print("Build Version: " .. _G.kwk_DebugBuildVersion);print("");	print("_G.kwk_currentPage: " .. _G.kwk_currentPage);print("_G.kwk_menuPage: " .. _G.kwk_menuPage);print("_G.kwk_lastPage: " .. _G.kwk_lastPage);print("")	for k,v in pairs(_G.kwk_firstPageOfChapter) do		chaps = chaps .. ", " .. v	end	chaps = chaps .. "."	print(chaps)end--if-- Sets whether they can see the clock etc.display.setStatusBar( display.HiddenStatusBar ) -- vs. display.setStatusBar( display.DefaultStatusBar ) _G.lang = "" kBidi = false kAutoPlay = 0local path = system.pathForFile( "SpoonAndTheMoonPart2.txt", system.DocumentsDirectory ) local file = io.open( path, "r" ) _G.kwk_currentPage = _G.kwk_firstPageif file then 	local kBookmark = 0	bookmarkedPage = file:read("*number") 	if type(bookmarkedPage) == "number" and bookmarkedPage >= _G.kwk_firstPage and bookmarkedPage <= _G.kwk_lastPage then kBookmark = 1 end	if _G.kwk_ShowDebugOutput then		print("Bookmark file exists!")		print("Starting page: " .. bookmarkedPage)		print("Is it legit: " .. kBookmark .. " - " .. type(bookmarkedPage))	end	if kBookmark > 0 and bookmarkedPage > _G.kwk_menuPage then _G.kwk_currentPage = bookmarkedPage end 	io.close(file) else 	print("Bookmark file does not exist yet!")	local file = io.open( path, "w+b" ) 	file:write( "1" ) 	io.close(file) end --Create a main grouplocal mainGroup = display.newGroup()-- Main functionlocal function main()	mainGroup:insert(director.directorView)	 -- This is how Corona knows to begin with page_1.lua	if _G.kwk_ShowDebugOutput then		print("")		print("Opening first page from main().")		print("Current page would be: " .. _G.kwk_currentPage)	end--if	director:changeScene("page_" .. _G.kwk_currentPage)	return trueend--Clear timers and transitionstimerStash = {}transitionStash = {}gtStash = {}function cancelAllSounds()	local i	for i = 1, 32, 1 do		isChannelPlaying = audio.isChannelPlaying(i) 		if isChannelPlaying then audio.stop(i) end		isChannelActive = audio.isChannelActive(i) 		if isChannelActive then audio.dispose(i) end	end--for-loopend--function end-all-soundsfunction cancelAllTimers()		local k, v		for k,v in pairs(timerStash) do				timer.cancel( v )				v = nil; k = nil		end		timerStash = nil		timerStash = {}endfunction cancelAllTransitions()		local k, v		for k,v in pairs(transitionStash) do				transition.cancel( v )				v = nil; k = nil		end		transitionStash = nil		transitionStash = {}end--cancel all gtweensfunction cancelAllTweens()		local k, v		for k,v in pairs(gtStash) do				v:pause();				v = nil; k = nil		end		gtStash = nil		gtStash = {}endfunction chButton(c, x, y, w, h)	local button	local onButtonTouch = function(event) 		if event.phase=="ended" then				cancelAllTweens(); 			cancelAllTimers(); 			cancelAllTransitions(); 			cancelAllSounds(); 			local myClosure_switch = function() 				_G.kwk_currentPage = _G.kwk_firstPageOfChapter[c]				if c > 0 then _G.kwk_currentPage = _G.kwk_firstPageOfChapter[c] else _G.kwk_currentPage = _G.kwk_creditsPage + 1 end				local gotoPage				if c > 0 then gotoPage = _G.kwk_currentPage else gotoPage = _G.kwk_creditsPage end								director:changeScene( "page_" .. gotoPage, "fade" ) 			end --end-function			timerStash.tempTimer = nil 			timerStash.tempTimer = timer.performWithDelay(0, myClosure_switch, 1) 		end --if-ended	end --function on-touch	if _G.kwk_ShowDebugOutput then unclickedButtonImage = "blankbutton.png" else unclickedButtonImage = "transparentbutton.png" end	button = ui.newButton{ 		defaultSrc= imageDir .. unclickedButtonImage, 		defaultX = w, 		defaultY = h, 		overSrc= imageDir .. "blankbutton.png", 		overX = w, 		overY = h, 		onRelease=onButtonTouch, 		id="chapter-" .. c .. "-button"	} 	button.x = x; button.y = y; button.alpha = 0.5; button.oldAlpha = 0.5	return buttonendmain()